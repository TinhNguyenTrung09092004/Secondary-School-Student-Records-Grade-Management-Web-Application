<div class="department-container">
  <div class="page-header">
    <h2>Quáº£n LÃ½ Tá»• Bá»™ MÃ´n</h2>
    <button class="btn btn-primary" (click)="openCreateModal()">+ ThÃªm Tá»• Bá»™ MÃ´n Má»›i</button>
  </div>

  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Äang táº£i dá»¯ liá»‡u...</p>
  </div>

  <div *ngIf="!loading && departmentList.length > 0" class="table-container">
    <table class="table">
      <thead>
        <tr>
          <th>MÃ£ Tá»• BM</th>
          <th>TÃªn Tá»• Bá»™ MÃ´n</th>
          <th>TrÆ°á»Ÿng Khoa</th>
          <th>Sá»‘ GiÃ¡o ViÃªn</th>
          <th>HÃ nh Ä‘á»™ng</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let department of departmentList">
          <td>{{ department.departmentId }}</td>
          <td>{{ department.departmentName }}</td>
          <td>{{ department.headTeacherName || '(ChÆ°a cÃ³)' }}</td>
          <td>{{ department.teacherCount }}</td>
          <td>
            <button class="btn btn-edit" (click)="openEditModal(department)" title="Chá»‰nh sá»­a">âœï¸ Sá»­a</button>
            <button class="btn btn-delete" (click)="deleteDepartment(department)" title="XÃ³a">ğŸ—‘ï¸ XÃ³a</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="!loading && departmentList.length === 0" class="empty-state">
    <p>ChÆ°a cÃ³ tá»• bá»™ mÃ´n nÃ o</p>
  </div>
</div>

<div *ngIf="showCreateModal" class="modal-overlay" (click)="closeCreateModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>ThÃªm Tá»• Bá»™ MÃ´n Má»›i</h3>
      <button class="close-btn" (click)="closeCreateModal()">&times;</button>
    </div>

    <div class="form-group">
      <label class="form-label">MÃ£ Tá»• Bá»™ MÃ´n <span class="required">*</span></label>
      <input type="text" class="form-control" [(ngModel)]="newDepartment.departmentId" maxlength="6" placeholder="VD: DEPT01">
    </div>

    <div class="form-group">
      <label class="form-label">TÃªn Tá»• Bá»™ MÃ´n <span class="required">*</span></label>
      <input type="text" class="form-control" [(ngModel)]="newDepartment.departmentName" maxlength="50" placeholder="Nháº­p tÃªn tá»• bá»™ mÃ´n">
    </div>

    <div class="form-group">
      <label class="form-label">TrÆ°á»Ÿng Khoa (TÃ¹y chá»n)</label>
      <select class="form-select" [(ngModel)]="newDepartment.headTeacherId">
        <option value="">-- Chá»n giÃ¡o viÃªn --</option>
        <option *ngFor="let teacher of teacherList" [value]="teacher.teacherId">
          {{ teacher.teacherId }} - {{ teacher.teacherName }}
        </option>
      </select>
    </div>

    <div class="modal-actions">
      <button class="btn btn-secondary" (click)="closeCreateModal()">Há»§y</button>
      <button class="btn btn-success" (click)="createDepartment()">âœ“ Táº¡o</button>
    </div>
  </div>
</div>

<div *ngIf="showEditModal" class="modal-overlay" (click)="closeEditModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Chá»‰nh Sá»­a Tá»• Bá»™ MÃ´n</h3>
      <button class="close-btn" (click)="closeEditModal()">&times;</button>
    </div>

    <div class="form-group">
      <label class="form-label">MÃ£ Tá»• Bá»™ MÃ´n</label>
      <input type="text" class="form-control" [value]="selectedDepartment?.departmentId" disabled>
    </div>

    <div class="form-group">
      <label class="form-label">TÃªn Tá»• Bá»™ MÃ´n <span class="required">*</span></label>
      <input type="text" class="form-control" [(ngModel)]="editDepartment.departmentName" maxlength="50">
    </div>

    <div class="form-group">
      <label class="form-label">TrÆ°á»Ÿng Khoa (TÃ¹y chá»n)</label>
      <select class="form-select" [(ngModel)]="editDepartment.headTeacherId">
        <option value="">-- Chá»n giÃ¡o viÃªn --</option>
        <option *ngFor="let teacher of teacherList" [value]="teacher.teacherId">
          {{ teacher.teacherId }} - {{ teacher.teacherName }}
        </option>
      </select>
    </div>

    <div class="modal-actions">
      <button class="btn btn-secondary" (click)="closeEditModal()">Há»§y</button>
      <button class="btn btn-primary" (click)="updateDepartment()">ğŸ’¾ Cáº­p nháº­t</button>
    </div>
  </div>
</div>

<div class="toast-container">
  <div *ngFor="let toast of toasts; let i = index"
       [class]="'toast ' + toast.type + (toast.closing ? ' slide-out' : '')">
    <div class="toast-icon">{{ toast.type === 'success' ? 'âœ“' : 'âœ•' }}</div>
    <div class="toast-content">
      <p class="toast-message">{{ toast.message }}</p>
    </div>
    <button class="toast-close" (click)="removeToast(i)">&times;</button>
  </div>
</div>
