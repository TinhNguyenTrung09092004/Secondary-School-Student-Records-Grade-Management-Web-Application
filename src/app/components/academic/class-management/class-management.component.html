<div class="class-container">
  <div class="page-header">
    <h2>{{ isPrincipal ? 'PhÃ¢n CÃ´ng GiÃ¡o ViÃªn Chá»§ Nhiá»‡m' : 'Quáº£n LÃ½ Lá»›p Há»c' }}</h2>
    <button *ngIf="!isPrincipal" class="btn btn-primary" (click)="openCreateModal()">+ ThÃªm Lá»›p Há»c Má»›i</button>
  </div>

  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Äang táº£i dá»¯ liá»‡u...</p>
  </div>

  <div *ngIf="!loading && classList.length > 0" class="table-container">
    <table class="table">
      <thead>
        <tr>
          <th>MÃ£ Lá»›p</th>
          <th>TÃªn Lá»›p</th>
          <th>Khá»‘i</th>
          <th>NÄƒm Há»c</th>
          <th>SÄ© Sá»‘ Tá»‘i Äa</th>
          <th>SÄ© Sá»‘ Hiá»‡n Táº¡i</th>
          <th>GVCN</th>
          <th>HÃ nh Ä‘á»™ng</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let class of classList">
          <td>{{ class.classId }}</td>
          <td>{{ class.className }}</td>
          <td>{{ class.gradeLevelName }}</td>
          <td>{{ class.schoolYearName }}</td>
          <td>{{ class.classSize }}</td>
          <td>{{ class.currentStudentCount }}</td>
          <td>{{ class.teacherName || 'ChÆ°a phÃ¢n cÃ´ng' }}</td>
          <td>
            <button *ngIf="!isPrincipal" class="btn btn-edit" (click)="openEditModal(class)" title="Chá»‰nh sá»­a">âœï¸ Sá»­a</button>
            <button class="btn btn-assign" (click)="openAssignTeacherModal(class)" title="PhÃ¢n cÃ´ng GVCN">ğŸ‘¨â€ğŸ« GVCN</button>
            <button *ngIf="!isPrincipal" class="btn btn-delete" (click)="deleteClass(class)" title="XÃ³a">ğŸ—‘ï¸ XÃ³a</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="!loading && classList.length === 0" class="empty-state">
    <p>ChÆ°a cÃ³ lá»›p há»c nÃ o</p>
  </div>
</div>

<div *ngIf="showCreateModal" class="modal-overlay" (click)="closeCreateModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>ThÃªm Lá»›p Há»c Má»›i</h3>
      <button class="close-btn" (click)="closeCreateModal()">&times;</button>
    </div>

    <div class="form-group">
      <label class="form-label">MÃ£ Lá»›p <span class="required">*</span></label>
      <input type="text" class="form-control" [(ngModel)]="newClass.classId" maxlength="10" placeholder="VD: 10A1">
    </div>

    <div class="form-group">
      <label class="form-label">TÃªn Lá»›p <span class="required">*</span></label>
      <input type="text" class="form-control" [(ngModel)]="newClass.className" maxlength="30" placeholder="Nháº­p tÃªn lá»›p">
    </div>

    <div class="form-group">
      <label class="form-label">Khá»‘i <span class="required">*</span></label>
      <select class="form-select" [(ngModel)]="newClass.gradeLevelId">
        <option value="">-- Chá»n Khá»‘i --</option>
        <option *ngFor="let gradeLevel of gradeLevelList" [value]="gradeLevel.gradeLevelId">
          {{ gradeLevel.gradeLevelName }}
        </option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label">NÄƒm Há»c <span class="required">*</span></label>
      <select class="form-select" [(ngModel)]="newClass.schoolYearId">
        <option value="">-- Chá»n NÄƒm Há»c --</option>
        <option *ngFor="let schoolYear of schoolYearList" [value]="schoolYear.schoolYearId">
          {{ schoolYear.schoolYearName }}
        </option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label">SÄ© Sá»‘ Tá»‘i Äa <span class="required">*</span></label>
      <input type="number" class="form-control" [(ngModel)]="newClass.classSize" min="1" max="100" placeholder="VD: 45">
    </div>

    <div class="info-note">
      <p><strong>LÆ°u Ã½:</strong> SÄ© sá»‘ hiá»‡n táº¡i sáº½ Ä‘Æ°á»£c tá»± Ä‘á»™ng tÃ­nh dá»±a trÃªn sá»‘ há»c sinh Ä‘Æ°á»£c phÃ¢n cÃ´ng vÃ o lá»›p. GiÃ¡o viÃªn chá»§ nhiá»‡m sáº½ Ä‘Æ°á»£c hiá»‡u trÆ°á»Ÿng phÃ¢n cÃ´ng sau.</p>
    </div>

    <div class="modal-actions">
      <button class="btn btn-secondary" (click)="closeCreateModal()">Há»§y</button>
      <button class="btn btn-success" (click)="createClass()">âœ“ Táº¡o</button>
    </div>
  </div>
</div>

<div *ngIf="showEditModal" class="modal-overlay" (click)="closeEditModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Chá»‰nh Sá»­a Lá»›p Há»c</h3>
      <button class="close-btn" (click)="closeEditModal()">&times;</button>
    </div>

    <div class="form-group">
      <label class="form-label">MÃ£ Lá»›p <span class="required">*</span></label>
      <input type="text" class="form-control" [(ngModel)]="editClass.classId" maxlength="10">
    </div>

    <div class="form-group">
      <label class="form-label">TÃªn Lá»›p <span class="required">*</span></label>
      <input type="text" class="form-control" [(ngModel)]="editClass.className" maxlength="30">
    </div>

    <div class="form-group">
      <label class="form-label">Khá»‘i <span class="required">*</span></label>
      <select class="form-select" [(ngModel)]="editClass.gradeLevelId">
        <option value="">-- Chá»n Khá»‘i --</option>
        <option *ngFor="let gradeLevel of gradeLevelList" [value]="gradeLevel.gradeLevelId">
          {{ gradeLevel.gradeLevelName }}
        </option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label">NÄƒm Há»c <span class="required">*</span></label>
      <select class="form-select" [(ngModel)]="editClass.schoolYearId">
        <option value="">-- Chá»n NÄƒm Há»c --</option>
        <option *ngFor="let schoolYear of schoolYearList" [value]="schoolYear.schoolYearId">
          {{ schoolYear.schoolYearName }}
        </option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label">SÄ© Sá»‘ Tá»‘i Äa <span class="required">*</span></label>
      <input type="number" class="form-control" [(ngModel)]="editClass.classSize" min="1" max="100">
    </div>

    <div class="info-note">
      <p><strong>LÆ°u Ã½:</strong> SÄ© sá»‘ hiá»‡n táº¡i Ä‘Æ°á»£c tá»± Ä‘á»™ng tÃ­nh. GiÃ¡o viÃªn chá»§ nhiá»‡m chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c thay Ä‘á»•i bá»Ÿi hiá»‡u trÆ°á»Ÿng.</p>
    </div>

    <div class="modal-actions">
      <button class="btn btn-secondary" (click)="closeEditModal()">Há»§y</button>
      <button class="btn btn-primary" (click)="updateClass()">ğŸ’¾ Cáº­p nháº­t</button>
    </div>
  </div>
</div>

<div *ngIf="showAssignTeacherModal" class="modal-overlay" (click)="closeAssignTeacherModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>PhÃ¢n CÃ´ng GiÃ¡o ViÃªn Chá»§ Nhiá»‡m</h3>
      <button class="close-btn" (click)="closeAssignTeacherModal()">&times;</button>
    </div>

    <div class="class-info">
      <p><strong>Lá»›p:</strong> {{ selectedClass?.className }}</p>
      <p><strong>Khá»‘i:</strong> {{ selectedClass?.gradeLevelName }}</p>
      <p><strong>NÄƒm há»c:</strong> {{ selectedClass?.schoolYearName }}</p>
    </div>

    <div class="warning-message">
      <p><strong>LÆ°u Ã½:</strong> Chá»‰ giÃ¡o viÃªn nÃ o giáº£ng dáº¡y Ã­t nháº¥t má»™t mÃ´n trong lá»›p nÃ y má»›i cÃ³ thá»ƒ Ä‘Æ°á»£c phÃ¢n cÃ´ng lÃ m giÃ¡o viÃªn chá»§ nhiá»‡m.</p>
    </div>

    <div *ngIf="eligibleTeacherList.length === 0" class="error-no-teachers">
      <p>KhÃ´ng cÃ³ giÃ¡o viÃªn Ä‘á»§ Ä‘iá»u kiá»‡n. Vui lÃ²ng phÃ¢n cÃ´ng giÃ¡o viÃªn giáº£ng dáº¡y mÃ´n há»c trong lá»›p trÆ°á»›c.</p>
    </div>

    <div *ngIf="eligibleTeacherList.length > 0" class="form-group">
      <label class="form-label">Chá»n GiÃ¡o ViÃªn Chá»§ Nhiá»‡m <span class="required">*</span></label>
      <select class="form-select" [(ngModel)]="selectedTeacherId">
        <option value="">-- Chá»n giÃ¡o viÃªn --</option>
        <option *ngFor="let teacher of eligibleTeacherList" [value]="teacher.teacherId">
          {{ teacher.teacherId }} - {{ teacher.teacherName }}
        </option>
      </select>
    </div>

    <div class="modal-actions">
      <button class="btn btn-secondary" (click)="closeAssignTeacherModal()">Há»§y</button>
      <button class="btn btn-success" (click)="assignHomeroomTeacher()" [disabled]="eligibleTeacherList.length === 0">âœ“ PhÃ¢n CÃ´ng</button>
    </div>
  </div>
</div>

<div class="toast-container">
  <div *ngFor="let toast of toasts; let i = index"
       [class]="'toast ' + toast.type + (toast.closing ? ' slide-out' : '')">
    <div class="toast-icon">{{ toast.type === 'success' ? 'âœ“' : 'âœ•' }}</div>
    <div class="toast-content">
      <p class="toast-message">{{ toast.message }}</p>
    </div>
    <button class="toast-close" (click)="removeToast(i)">&times;</button>
  </div>
</div>
